{% extends "base.html" %}

{% block title %}Search - OpenClaw Knowledgebase{% endblock %}

{% block content %}
<div class="p-6 space-y-6">
    <!-- Header -->
    <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-400 to-cyan-600 flex items-center justify-center shadow-lg shadow-cyan-500/30">
            <i data-lucide="search" class="w-6 h-6 text-white"></i>
        </div>
        <div>
            <h1 class="text-2xl font-bold">Semantic Search</h1>
            <p class="text-gray-400">Search your knowledge base with AI</p>
        </div>
    </div>
    
    <!-- Search Form -->
    <div class="glass rounded-xl p-6 glow-pulse">
        <form id="search-form" class="space-y-4">
            <div class="relative">
                <input type="text" name="q" id="search-input" value="{{ query }}"
                    placeholder="Ask anything... e.g., 'How do I create an automation in Home Assistant?'"
                    class="w-full px-4 py-4 pl-12 text-lg rounded-xl glass-light border border-white/10 
                           focus:border-cyan-500/50 focus:outline-none focus:ring-2 focus:ring-cyan-500/20
                           placeholder-gray-500 text-white"
                    hx-get="/htmx/search-results"
                    hx-trigger="keyup changed delay:300ms"
                    hx-target="#results"
                    hx-include="[name='hybrid'], [name='limit']">
                <i data-lucide="sparkles" class="w-6 h-6 text-cyan-400 absolute left-4 top-1/2 -translate-y-1/2"></i>
                
                <!-- Loading indicator -->
                <div class="htmx-indicator absolute right-4 top-1/2 -translate-y-1/2">
                    <i data-lucide="loader-2" class="w-5 h-5 text-cyan-400 animate-spin"></i>
                </div>
            </div>
            
            <!-- Options -->
            <div class="flex items-center gap-6">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="hybrid" id="hybrid-toggle" {% if hybrid %}checked{% endif %}
                        class="w-4 h-4 rounded border-gray-600 bg-gray-700 text-cyan-500 focus:ring-cyan-500 focus:ring-offset-0"
                        hx-get="/htmx/search-results"
                        hx-trigger="change"
                        hx-target="#results"
                        hx-include="#search-input, [name='limit']">
                    <span class="text-sm text-gray-300">Hybrid Search</span>
                    <span class="text-xs text-gray-500">(semantic + keyword)</span>
                </label>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm text-gray-400">Results:</label>
                    <select name="limit" 
                        class="px-3 py-1.5 rounded-lg glass-light border border-white/10 text-sm text-white focus:outline-none focus:border-cyan-500/50"
                        hx-get="/htmx/search-results"
                        hx-trigger="change"
                        hx-target="#results"
                        hx-include="#search-input, #hybrid-toggle">
                        <option value="5" {% if limit == 5 %}selected{% endif %}>5</option>
                        <option value="10" {% if limit == 10 %}selected{% endif %}>10</option>
                        <option value="20" {% if limit == 20 %}selected{% endif %}>20</option>
                        <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm text-gray-400">Min Score:</label>
                    <select name="threshold" id="threshold-select"
                        class="px-3 py-1.5 rounded-lg glass-light border border-white/10 text-sm text-white focus:outline-none focus:border-cyan-500/50"
                        hx-get="/htmx/search-results"
                        hx-trigger="change"
                        hx-target="#results"
                        hx-include="#search-input, #hybrid-toggle, [name='limit']">
                        <option value="0.3">30%</option>
                        <option value="0.5" selected>50%</option>
                        <option value="0.6">60%</option>
                        <option value="0.7">70%</option>
                    </select>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Results Header -->
    {% if query and results %}
    <div class="flex items-center justify-between">
        <p class="text-sm text-gray-400">{{ results|length }} results for "{{ query }}"</p>
        
        <!-- Export Buttons -->
        <div class="flex items-center gap-2">
            <span class="text-xs text-gray-500">Export:</span>
            <a href="/api/export/search?q={{ query }}&format=json&limit=50&hybrid={{ hybrid }}" 
               class="px-2 py-1 text-xs rounded bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white">
                JSON
            </a>
            <a href="/api/export/search?q={{ query }}&format=markdown&limit=50&hybrid={{ hybrid }}" 
               class="px-2 py-1 text-xs rounded bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white">
                Markdown
            </a>
            <a href="/api/export/search?q={{ query }}&format=csv&limit=50&hybrid={{ hybrid }}" 
               class="px-2 py-1 text-xs rounded bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white">
                CSV
            </a>
        </div>
    </div>
    {% endif %}
    
    <!-- Results -->
    <div id="results">
        {% if query %}
            {% include "partials/search_results.html" %}
        {% else %}
        <div class="text-center py-16">
            <i data-lucide="search" class="w-16 h-16 text-gray-600 mx-auto mb-4"></i>
            <p class="text-gray-500">Enter a query to search your knowledge base</p>
            <p class="text-gray-600 text-sm mt-2">Try questions like "How do I..." or technical terms</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
